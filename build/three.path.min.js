// https://github.com/shawn0326/three.path
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t.THREE||{})}(this,(function(t){"use strict";var e=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1};e.prototype.lerpPathPoints=function(t,e,r){this.pos.lerpVectors(t.pos,e.pos,r),this.dir.lerpVectors(t.dir,e.dir,r),this.up.lerpVectors(t.up,e.up,r),this.right.lerpVectors(t.right,e.right,r),this.dist=(e.dist-t.dist)*r+t.dist,this.widthScale=(e.widthScale-t.widthScale)*r+t.widthScale},e.prototype.copy=function(t){this.pos.copy(t.pos),this.dir.copy(t.dir),this.up.copy(t.up),this.right.copy(t.right),this.dist=t.dist,this.widthScale=t.widthScale};var r=function(){this.array=[],this.count=0};r.prototype.set=function(t,e,r,i,s){if((t=t.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");e=void 0!==e?e:.1,r=void 0!==r?r:10,(s=void 0!==s&&s)&&!t[0].equals(t[t.length-1])&&t.push((new THREE.Vector3).copy(t[0]));for(var a=0,o=t.length;a<o;a++)if(0===a)this._start(t[a],t[a+1],i);else if(a===o-1)if(s){this._corner(t[a],t[1],e,r,i);var n=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=n}else this._end(t[a]);else this._corner(t[a],t[a+1],e,r,i)},r.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},r.prototype._start=function(t,e,r){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(t),i.dir.subVectors(e,t),r)i.up.copy(r);else{var s=Number.MAX_VALUE,a=Math.abs(i.dir.x),o=Math.abs(i.dir.y),n=Math.abs(i.dir.z);a<s&&(s=a,i.up.set(1,0,0)),o<s&&(s=o,i.up.set(0,1,0)),n<s&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.sharp=!1,i.dir.normalize(),this.count++};var i=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,n=new THREE.QuadraticBezierCurve3;r.prototype._corner=function(t,e,r,i,s){if(r>0&&i>0){for(var a=this.array[this.count-1],o=this._getCornerBezierCurve(a.pos,t,e,r,n).getPoints(i),h=0;h<i;h+=1)this._sharpCorner(o[h],o[h+1],s,0===h?1:0);o[i].equals(e)||this._sharpCorner(o[i],e,s,2)}else this._sharpCorner(t,e,s,0,!0)},r.prototype._sharpCorner=function(t,e,r,n,h){var u=this.array[this.count-1],p=this._getByIndex(this.count),d=i.subVectors(t,u.pos),c=s.subVectors(e,t),l=d.length();if(d.normalize(),c.normalize(),p.pos.copy(t),n?1===n?p.dir.copy(d):2===n&&p.dir.copy(c):(p.dir.addVectors(d,c),p.dir.normalize()),r)1===p.dir.dot(r)?p.right.crossVectors(c,r).normalize():p.right.crossVectors(p.dir,r).normalize(),p.up.crossVectors(p.right,p.dir).normalize();else{p.up.copy(u.up);var y=a.crossVectors(u.dir,p.dir);if(y.length()>Number.EPSILON){y.normalize();var g=Math.acos(Math.min(Math.max(u.dir.dot(p.dir),-1),1));p.up.applyMatrix4(o.makeRotationAxis(y,g))}p.right.crossVectors(p.dir,p.up).normalize()}p.dist=u.dist+l;var f=d.dot(c);p.widthScale=Math.min(1/Math.sqrt((1+f)/2),1.415)||1,p.sharp=Math.abs(f-1)>.05&&h,this.count++},r.prototype._end=function(t){var e=this.array[this.count-1],r=this._getByIndex(this.count);r.pos.copy(t),r.dir.subVectors(t,e.pos);var s=r.dir.length();r.dir.normalize(),r.up.copy(e.up);var a=i.crossVectors(e.dir,r.dir);if(a.length()>Number.EPSILON){a.normalize();var n=Math.acos(Math.min(Math.max(e.dir.dot(r.dir),-1),1));r.up.applyMatrix4(o.makeRotationAxis(a,n))}r.right.crossVectors(r.dir,r.up).normalize(),r.dist=e.dist+s,r.widthScale=1,r.sharp=!1,this.count++},r.prototype._getByIndex=function(t){return this.array[t]||(this.array[t]=new e),this.array[t]},r.prototype._getCornerBezierCurve=function(t,e,r,a,o){var n=i.subVectors(e,t),h=s.subVectors(r,e),u=n.length(),p=h.length();return n.normalize(),h.normalize(),u>a?o.v0.copy(e).sub(n.multiplyScalar(a)):o.v0.copy(t),o.v1.copy(e),p>a?o.v2.copy(e).add(h.multiplyScalar(a)):o.v2.copy(r),o};var h=function(t,e){THREE.BufferGeometry.call(this),t=t||3e3,this.setAttribute?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*t),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*t),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*t),2).setUsage(THREE.DynamicDrawUsage)),e&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(2*t),2).setUsage(THREE.DynamicDrawUsage))):(this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*t),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*t),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*t),2).setDynamic(!0)),e&&this.addAttribute("uv2",new THREE.BufferAttribute(new Float32Array(2*t),2).setDynamic(!0))),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(new Array(3*t))};h.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:h,update:function(t,e){e=e||{};var r=this._updateAttributes(t,e);this.drawRange.count=r},_resizeAttribute:function(t,e,r){for(;e.array.length<r;){var i=e.array.length,s=new THREE.BufferAttribute(new Float32Array(2*i),e.itemSize,e.normalized);s.name=e.name,s.usage=e.usage,this.setAttribute?this.setAttribute(t,s):this.addAttribute(t,s),e=s}},_resizeIndex:function(t,e){for(;t.array.length<e;){var r=t.array.length,i=new THREE.BufferAttribute(2*r>65535?new Uint32Array(2*r):new Uint16Array(2*r),1);i.name=t.name,i.usage=t.usage,this.setIndex(i),t=i}},_updateAttributes:function(t,r){var i=r.width||.1,s=void 0!==r.progress?r.progress:1,a=void 0===r.arrow||r.arrow,o=void 0!==r.side?r.side:"both",n=i/2,h="both"!==o?i/2:i,u=t.distance(),p=s*u;if(0==u)return 0;var d=n/h,c=n/u,l=!!this.getAttribute("uv2"),y=0,g=[],f=[],b=[],v=[],E=[],A=0,w=new THREE.Vector3,z=new THREE.Vector3,m=new THREE.Vector3,x=new THREE.Vector3,R=new THREE.Vector3,T=new THREE.Vector3;function V(t){var e=0===g.length,r=t.sharp&&!e,i=t.dist/h,s=t.dist/u,a=t.dir,p=t.up,V=t.right;if("left"!==o?w.copy(V).multiplyScalar(n*t.widthScale):w.set(0,0,0),"right"!==o?z.copy(V).multiplyScalar(-n*t.widthScale):z.set(0,0,0),w.add(t.pos),z.add(t.pos),r){m.fromArray(g,g.length-6).sub(z),x.fromArray(g,g.length-3).sub(w);var H,_,S=m.length()-x.length();S>0?(H=m,_=z):(H=x,_=w),R.copy(H).setLength(Math.abs(S)).add(_);let t=T.copy(_).sub(R).normalize().dot(a)*T.copy(_).sub(R).length()*2;T.copy(a).setLength(t).add(R),S>0?(g.push(R.x,R.y,R.z,w.x,w.y,w.z,z.x,z.y,z.z,w.x,w.y,w.z,T.x,T.y,T.z,w.x,w.y,w.z),A+=6,E.push(A-6,A-8,A-7,A-6,A-7,A-5,A-4,A-6,A-5,A-2,A-4,A-1),y+=12):(g.push(z.x,z.y,z.z,R.x,R.y,R.z,z.x,z.y,z.z,w.x,w.y,w.z,z.x,z.y,z.z,T.x,T.y,T.z),A+=6,E.push(A-6,A-8,A-7,A-6,A-7,A-5,A-6,A-5,A-3,A-2,A-3,A-1),y+=12),f.push(p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z),b.push(i-d,0,i-d,1,i,0,i,1,i+d,0,i+d,1),l&&v.push(s-c,0,s-c,1,s,0,s,1,s+c,0,s+c,1)}else g.push(z.x,z.y,z.z,w.x,w.y,w.z),f.push(p.x,p.y,p.z,p.x,p.y,p.z),b.push(i,0,i,1),l&&v.push(s,0,s,1),A+=2,e||(E.push(A-2,A-4,A-3,A-2,A-3,A-1),y+=6)}var H,_=new THREE.Vector3;if(p>0)for(var S=0;S<t.count;S++){var M=t.array[S];if(M.dist>p){var U=t.array[S-1];H=new e;var B=(p-U.dist)/(M.dist-U.dist);H.lerpPathPoints(U,M,B),V(H);break}V(M)}else H=t.array[0];a&&function(t){var e=t.dir,r=t.up,s=t.right,a=t.dist/h,p=t.dist/u;"left"!==o?w.copy(s).multiplyScalar(2*n):w.set(0,0,0),"right"!==o?z.copy(s).multiplyScalar(2*-n):z.set(0,0,0),_.copy(e).setLength(3*n),w.add(t.pos),z.add(t.pos),_.add(t.pos),g.push(z.x,z.y,z.z,w.x,w.y,w.z,_.x,_.y,_.z),f.push(r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z),b.push(a,"both"!==o?"right"!==o?-2:0:-.5,a,"both"!==o?"left"!==o?2:0:1.5,a+1.5,"both"!==o?0:.5),l&&v.push(p,"both"!==o?"right"!==o?-2:0:-.5,p,"both"!==o?"left"!==o?2:0:1.5,p+1.5*i/u,"both"!==o?0:.5),A+=3,E.push(A-1,A-3,A-2),y+=3}(H=H||t.array[t.count-1]);var P=this.getAttribute("position");this._resizeAttribute("position",P,g.length),(P=this.getAttribute("position")).array.set(g,0),P.updateRange.count=g.length,P.needsUpdate=!0;var I=this.getAttribute("normal");this._resizeAttribute("normal",I,f.length),(I=this.getAttribute("normal")).array.set(f,0),I.updateRange.count=f.length,I.needsUpdate=!0;var D=this.getAttribute("uv");if(this._resizeAttribute("uv",D,b.length),(D=this.getAttribute("uv")).array.set(b,0),D.updateRange.count=b.length,D.needsUpdate=!0,l){var C=this.getAttribute("uv2");this._resizeAttribute("uv2",C,v.length),(C=this.getAttribute("uv2")).array.set(v,0),C.updateRange.count=v.length,C.needsUpdate=!0}var F=this.getIndex();return this._resizeIndex(F,E.length),(F=this.getIndex()).set(E,0),F.updateRange.count=E.length,F.needsUpdate=!0,y}});var u=function(t,e){h.call(this,t||1e3,e)};u.prototype=Object.assign(Object.create(h.prototype),{constructor:u,_updateAttributes:function(t,r){var i=r.radius||.1,s=Math.max(2,r.radialSegments||8),a=r.startRad||0,o=void 0!==r.progress?r.progress:1,n=2*i*Math.PI,h=t.distance(),u=o*h;if(0==u)return 0;var p=!!this.getAttribute("uv2"),d=0,c=[],l=[],y=[],g=[],f=[],b=0,v=new THREE.Vector3;function E(t,e,r){for(var i=0===c.length,s=t.dist/n,o=t.dist/h,u=0;u<=r;u++){var E=u;E==r&&(E=0),v.copy(t.up).applyAxisAngle(t.dir,a+2*Math.PI*E/r).normalize(),c.push(t.pos.x+v.x*e*t.widthScale,t.pos.y+v.y*e*t.widthScale,t.pos.z+v.z*e*t.widthScale),l.push(v.x,v.y,v.z),y.push(s,u/r),p&&g.push(o,u/r),b++}if(!i)for(var A=b-2*(r+1),w=b-(r+1),z=0;z<r;z++)f.push(w+z,A+z,A+z+1,w+z,A+z+1,w+z+1),d+=6}if(u>0)for(var A=0;A<t.count;A++){var w=t.array[A];if(w.dist>u){var z=t.array[A-1],m=new e,x=(u-z.dist)/(w.dist-z.dist);m.lerpPathPoints(z,w,x),E(m,i,s);break}E(w,i,s)}var R=this.getAttribute("position");this._resizeAttribute("position",R,c.length),(R=this.getAttribute("position")).array.set(c,0),R.updateRange.count=c.length,R.needsUpdate=!0;var T=this.getAttribute("normal");this._resizeAttribute("normal",T,l.length),(T=this.getAttribute("normal")).array.set(l,0),T.updateRange.count=l.length,T.needsUpdate=!0;var V=this.getAttribute("uv");if(this._resizeAttribute("uv",V,y.length),(V=this.getAttribute("uv")).array.set(y,0),V.updateRange.count=y.length,V.needsUpdate=!0,p){var H=this.getAttribute("uv2");this._resizeAttribute("uv2",H,g.length),(H=this.getAttribute("uv2")).array.set(g,0),H.updateRange.count=g.length,H.needsUpdate=!0}var _=this.getIndex();return this._resizeIndex(_,f.length),(_=this.getIndex()).set(f,0),_.updateRange.count=f.length,_.needsUpdate=!0,d}}),t.PathGeometry=h,t.PathPointList=r,t.PathTubeGeometry=u,Object.defineProperty(t,"__esModule",{value:!0})}));
