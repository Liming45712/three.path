// https://github.com/shawn0326/three.path
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t.THREE||{})}(this,(function(t){"use strict";var e=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1};e.prototype.lerpPathPoints=function(t,e,r){this.pos.lerpVectors(t.pos,e.pos,r),this.dir.lerpVectors(t.dir,e.dir,r),this.up.lerpVectors(t.up,e.up,r),this.right.lerpVectors(t.right,e.right,r),this.dist=(e.dist-t.dist)*r+t.dist,this.widthScale=(e.widthScale-t.widthScale)*r+t.widthScale},e.prototype.copy=function(t){this.pos.copy(t.pos),this.dir.copy(t.dir),this.up.copy(t.up),this.right.copy(t.right),this.dist=t.dist,this.widthScale=t.widthScale};var r=function(){this.array=[],this.count=0};r.prototype.set=function(t,e,r,i,s){if((t=t.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");e=void 0!==e?e:.1,r=void 0!==r?r:10,(s=void 0!==s&&s)&&!t[0].equals(t[t.length-1])&&t.push((new THREE.Vector3).copy(t[0]));for(var a=0,o=t.length;a<o;a++)if(0===a)this._start(t[a],t[a+1],i);else if(a===o-1)if(s){this._corner(t[a],t[1],e,r,i);var n=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=n}else this._end(t[a]);else this._corner(t[a],t[a+1],e,r,i)},r.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},r.prototype._start=function(t,e,r){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(t),i.dir.subVectors(e,t),r)i.up.copy(r);else{var s=Number.MAX_VALUE,a=Math.abs(i.dir.x),o=Math.abs(i.dir.y),n=Math.abs(i.dir.z);a<s&&(s=a,i.up.set(1,0,0)),o<s&&(s=o,i.up.set(0,1,0)),n<s&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.sharp=!1,i.dir.normalize(),this.count++};var i=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,n=new THREE.QuadraticBezierCurve3;r.prototype._corner=function(t,e,r,i,s){if(r>0&&i>0){for(var a=this.array[this.count-1],o=this._getCornerBezierCurve(a.pos,t,e,r,n).getPoints(i),h=0;h<i;h+=1)this._sharpCorner(o[h],o[h+1],s,0===h?1:0);o[i].equals(e)||this._sharpCorner(o[i],e,s,2)}else this._sharpCorner(t,e,s,0,!0)},r.prototype._sharpCorner=function(t,e,r,n,h){var u=this.array[this.count-1],p=this._getByIndex(this.count),d=i.subVectors(t,u.pos),c=s.subVectors(e,t),l=d.length();if(d.normalize(),c.normalize(),p.pos.copy(t),n?1===n?p.dir.copy(d):2===n&&p.dir.copy(c):(p.dir.addVectors(d,c),p.dir.normalize()),r)1===p.dir.dot(r)?p.right.crossVectors(c,r).normalize():p.right.crossVectors(p.dir,r).normalize(),p.up.crossVectors(p.right,p.dir).normalize();else{p.up.copy(u.up);var y=a.crossVectors(u.dir,p.dir);if(y.length()>Number.EPSILON){y.normalize();var g=Math.acos(Math.min(Math.max(u.dir.dot(p.dir),-1),1));p.up.applyMatrix4(o.makeRotationAxis(y,g))}p.right.crossVectors(p.dir,p.up).normalize()}p.dist=u.dist+l;var f=d.dot(c);p.widthScale=Math.min(1/Math.sqrt((1+f)/2),1.415)||1,p.sharp=Math.abs(f-1)>.05&&h,this.count++},r.prototype._end=function(t){var e=this.array[this.count-1],r=this._getByIndex(this.count);r.pos.copy(t),r.dir.subVectors(t,e.pos);var s=r.dir.length();r.dir.normalize(),r.up.copy(e.up);var a=i.crossVectors(e.dir,r.dir);if(a.length()>Number.EPSILON){a.normalize();var n=Math.acos(Math.min(Math.max(e.dir.dot(r.dir),-1),1));r.up.applyMatrix4(o.makeRotationAxis(a,n))}r.right.crossVectors(r.dir,r.up).normalize(),r.dist=e.dist+s,r.widthScale=1,r.sharp=!1,this.count++},r.prototype._getByIndex=function(t){return this.array[t]||(this.array[t]=new e),this.array[t]},r.prototype._getCornerBezierCurve=function(t,e,r,a,o){var n=i.subVectors(e,t),h=s.subVectors(r,e),u=n.length(),p=h.length();return n.normalize(),h.normalize(),u>a?o.v0.copy(e).sub(n.multiplyScalar(a)):o.v0.copy(t),o.v1.copy(e),p>a?o.v2.copy(e).add(h.multiplyScalar(a)):o.v2.copy(r),o};var h=function(t){THREE.BufferGeometry.call(this),t=t||3e3,this.setAttribute?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*t),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*t),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*t),2).setUsage(THREE.DynamicDrawUsage))):(this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*t),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*t),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*t),2).setDynamic(!0))),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(new Array(3*t))};h.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:h,update:function(t,e){e=e||{};var r=this._updateAttributes(t,e);this.drawRange.count=r},_resizeAttribute:function(t,e,r){for(;e.array.length<r;){var i=e.array.length,s=new THREE.BufferAttribute(new Float32Array(2*i),e.itemSize,e.normalized);s.name=e.name,s.usage=e.usage,this.setAttribute?this.setAttribute(t,s):this.addAttribute(t,s),e=s}},_resizeIndex:function(t,e){for(;t.array.length<e;){var r=t.array.length,i=new THREE.BufferAttribute(2*r>65535?new Uint32Array(2*r):new Uint16Array(2*r),1);i.name=t.name,i.usage=t.usage,this.setIndex(i),t=i}},_updateAttributes:function(t,r){var i=r.width||.1,s=void 0!==r.progress?r.progress:1,a=void 0===r.arrow||r.arrow,o=void 0!==r.side?r.side:"both",n=0,h=[],u=[],p=[],d=[],c=0,l=new THREE.Vector3,y=new THREE.Vector3,g=new THREE.Vector3,f=new THREE.Vector3,b=new THREE.Vector3,E=new THREE.Vector3;function v(t,e,r){var s=0===h.length,a=t.sharp&&!s,v=t.dir,z=t.up,m=t.right;if("left"!==o?l.copy(m).multiplyScalar(e*t.widthScale):l.set(0,0,0),"right"!==o?y.copy(m).multiplyScalar(-e*t.widthScale):y.set(0,0,0),l.add(t.pos),y.add(t.pos),a){g.fromArray(h,h.length-6).sub(y),f.fromArray(h,h.length-3).sub(l);var w,A,x=g.length()-f.length();x>0?(w=g,A=y):(w=f,A=l),b.copy(w).setLength(Math.abs(x)).add(A);let t=E.copy(A).sub(b).normalize().dot(v)*E.copy(A).sub(b).length()*2;E.copy(v).setLength(t).add(b),x>0?(h.push(b.x,b.y,b.z,l.x,l.y,l.z,y.x,y.y,y.z,l.x,l.y,l.z,E.x,E.y,E.z,l.x,l.y,l.z),c+=6,d.push(c-6,c-8,c-7,c-6,c-7,c-5,c-4,c-6,c-5,c-2,c-4,c-1),n+=12):(h.push(y.x,y.y,y.z,b.x,b.y,b.z,y.x,y.y,y.z,l.x,l.y,l.z,y.x,y.y,y.z,E.x,E.y,E.z),c+=6,d.push(c-6,c-8,c-7,c-6,c-7,c-5,c-6,c-5,c-3,c-2,c-3,c-1),n+=12),u.push(z.x,z.y,z.z,z.x,z.y,z.z,z.x,z.y,z.z,z.x,z.y,z.z,z.x,z.y,z.z,z.x,z.y,z.z);let s=e/("both"!==o?i/2:i);p.push(r-s,0,r-s,1,r,0,r,1,r+s,0,r+s,1)}else h.push(y.x,y.y,y.z,l.x,l.y,l.z),u.push(z.x,z.y,z.z,z.x,z.y,z.z),p.push(r,0,r,1),c+=2,s||(d.push(c-2,c-4,c-3,c-2,c-3,c-1),n+=6)}var z=new THREE.Vector3;var m=t.distance();if(0==m)return 0;var w,A=s*m;if(A>0)for(var x=0;x<t.count;x++){var R=t.array[x];if(R.dist>A){var V=t.array[x-1];w=new e;var T=(A-V.dist)/(R.dist-V.dist);w.lerpPathPoints(V,R,T),v(w,i/2,w.dist/("both"!==o?i/2:i));break}v(R,i/2,R.dist/("both"!==o?i/2:i))}else w=t.array[0];a&&function(t,e,r){var i=t.dir,s=t.up,a=t.right;"left"!==o?l.copy(a).multiplyScalar(2*e):l.set(0,0,0),"right"!==o?y.copy(a).multiplyScalar(2*-e):y.set(0,0,0),z.copy(i).setLength(3*e),l.add(t.pos),y.add(t.pos),z.add(t.pos),h.push(y.x,y.y,y.z,l.x,l.y,l.z,z.x,z.y,z.z),u.push(s.x,s.y,s.z,s.x,s.y,s.z,s.x,s.y,s.z),p.push(r,"both"!==o?"right"!==o?-2:0:-.5,r,"both"!==o?"left"!==o?2:0:1.5,r+3*e/("both"!==o?e:2*e),"both"!==o?0:.5),c+=3,d.push(c-1,c-3,c-2),n+=3}(w=w||t.array[t.count-1],i/2,w.dist/("both"!==o?i/2:i));var H=this.getAttribute("position"),_=this.getAttribute("normal"),S=this.getAttribute("uv"),M=this.getIndex();return this._resizeAttribute("position",H,h.length),this._resizeAttribute("normal",_,u.length),this._resizeAttribute("uv",S,p.length),this._resizeIndex(M,d.length),H=this.getAttribute("position"),_=this.getAttribute("normal"),S=this.getAttribute("uv"),M=this.getIndex(),H.array.set(h,0),_.array.set(u,0),S.array.set(p,0),M.set(d,0),H.updateRange.count=h.length,_.updateRange.count=u.length,S.updateRange.count=p.length,M.updateRange.count=d.length,H.needsUpdate=!0,_.needsUpdate=!0,S.needsUpdate=!0,M.needsUpdate=!0,n}});var u=function(t){h.call(this,t||1e3)};u.prototype=Object.assign(Object.create(h.prototype),{constructor:u,_updateAttributes:function(t,r){var i=r.radius||.1,s=Math.max(2,r.radialSegments||8),a=r.startRad||0,o=void 0!==r.progress?r.progress:1,n=0,h=[],u=[],p=[],d=[],c=0,l=new THREE.Vector3;function y(t,e,r,i){for(var s=0===h.length,o=0;o<=r;o++){var y=o;y==r&&(y=0),l.copy(t.up).applyAxisAngle(t.dir,a+2*Math.PI*y/r).normalize(),h.push(t.pos.x+l.x*e*t.widthScale,t.pos.y+l.y*e*t.widthScale,t.pos.z+l.z*e*t.widthScale),u.push(l.x,l.y,l.z),p.push(i,o/r),c++}if(!s)for(var g=c-2*(r+1),f=c-(r+1),b=0;b<r;b++)d.push(f+b,g+b,g+b+1,f+b,g+b+1,f+b+1),n+=6}var g=o*t.distance();if(0==g)return 0;if(g>0)for(var f=0;f<t.count;f++){var b=t.array[f];if(b.dist>g){var E=t.array[f-1],v=new e,z=(g-E.dist)/(b.dist-E.dist);v.lerpPathPoints(E,b,z),y(v,i,s,v.dist/(2*i*Math.PI));break}y(b,i,s,b.dist/(2*i*Math.PI))}var m=this.getAttribute("position"),w=this.getAttribute("normal"),A=this.getAttribute("uv"),x=this.getIndex();return this._resizeAttribute("position",m,h.length),this._resizeAttribute("normal",w,u.length),this._resizeAttribute("uv",A,p.length),this._resizeIndex(x,d.length),m=this.getAttribute("position"),w=this.getAttribute("normal"),A=this.getAttribute("uv"),x=this.getIndex(),m.array.set(h,0),w.array.set(u,0),A.array.set(p,0),x.set(d,0),m.updateRange.count=h.length,w.updateRange.count=u.length,A.updateRange.count=p.length,x.updateRange.count=d.length,m.needsUpdate=!0,w.needsUpdate=!0,A.needsUpdate=!0,x.needsUpdate=!0,n}}),t.PathGeometry=h,t.PathPointList=r,t.PathTubeGeometry=u,Object.defineProperty(t,"__esModule",{value:!0})}));
