// github.com/shawn0326/three.path
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t.THREE||{})}(this,(function(t){"use strict";var r=function(){function t(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1}var r=t.prototype;return r.lerpPathPoints=function(t,r,e){this.pos.lerpVectors(t.pos,r.pos,e),this.dir.lerpVectors(t.dir,r.dir,e),this.up.lerpVectors(t.up,r.up,e),this.right.lerpVectors(t.right,r.right,e),this.dist=(r.dist-t.dist)*e+t.dist,this.widthScale=(r.widthScale-t.widthScale)*e+t.widthScale},r.copy=function(t){this.pos.copy(t.pos),this.dir.copy(t.dir),this.up.copy(t.up),this.right.copy(t.right),this.dist=t.dist,this.widthScale=t.widthScale},t}(),e=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Matrix4,o=new THREE.QuadraticBezierCurve3;var n=function(){function t(){this.array=[],this.count=0}var n=t.prototype;return n.set=function(t,r,e,i,s){if(void 0===r&&(r=.1),void 0===e&&(e=10),void 0===i&&(i=null),void 0===s&&(s=!1),(t=t.slice(0)).length<2)return console.warn("PathPointList: points length less than 2."),void(this.count=0);s&&!t[0].equals(t[t.length-1])&&t.push((new THREE.Vector3).copy(t[0]));for(var a=0,o=t.length;a<o;a++)if(0===a)this._start(t[a],t[a+1],i);else if(a===o-1)if(s){this._corner(t[a],t[1],r,e,i);var n=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=n}else this._end(t[a]);else this._corner(t[a],t[a+1],r,e,i)},n.distance=function(){return this.count>0?this.array[this.count-1].dist:0},n._getByIndex=function(t){return this.array[t]||(this.array[t]=new r),this.array[t]},n._start=function(t,r,e){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(t),i.dir.subVectors(r,t),e)i.up.copy(e);else{var s=Number.MAX_VALUE,a=Math.abs(i.dir.x),o=Math.abs(i.dir.y),n=Math.abs(i.dir.z);a<s&&(s=a,i.up.set(1,0,0)),o<s&&(s=o,i.up.set(0,1,0)),n<s&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.sharp=!1,i.dir.normalize(),this.count++},n._end=function(t){var r=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(t),i.dir.subVectors(t,r.pos);var s=i.dir.length();i.dir.normalize(),i.up.copy(r.up);var o=e.crossVectors(r.dir,i.dir);if(o.length()>Number.EPSILON){o.normalize();var n=Math.acos(Math.min(Math.max(r.dir.dot(i.dir),-1),1));i.up.applyMatrix4(a.makeRotationAxis(o,n))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=r.dist+s,i.widthScale=1,i.sharp=!1,this.count++},n._corner=function(t,r,s,a,n){if(s>0&&a>0){for(var u=function(t,r,s,a,o){var n=e.subVectors(r,t),u=i.subVectors(s,r),h=n.length(),c=u.length();n.normalize(),u.normalize();var d=Math.min(h/2-Number.EPSILON,a);o.v0.copy(r).sub(n.multiplyScalar(d)),o.v1.copy(r);var p=Math.min(c/2-Number.EPSILON,a);return o.v2.copy(r).add(u.multiplyScalar(p)),o}(this.array[this.count-1].pos,t,r,s,o).getPoints(a),h=0;h<a;h++)this._sharpCorner(u[h],u[h+1],n,0===h?1:0);u[a].equals(r)||this._sharpCorner(u[a],r,n,2)}else this._sharpCorner(t,r,n,0,!0)},n._sharpCorner=function(t,r,o,n,u){void 0===n&&(n=0),void 0===u&&(u=!1);var h=this.array[this.count-1],c=this._getByIndex(this.count),d=e.subVectors(t,h.pos),p=i.subVectors(r,t),l=d.length();if(d.normalize(),p.normalize(),c.pos.copy(t),1===n?c.dir.copy(d):2===n?c.dir.copy(p):(c.dir.addVectors(d,p),c.dir.normalize()),o)1===c.dir.dot(o)?c.right.crossVectors(p,o).normalize():c.right.crossVectors(c.dir,o).normalize(),c.up.crossVectors(c.right,c.dir).normalize();else{c.up.copy(h.up);var y=s.crossVectors(h.dir,c.dir);if(y.length()>Number.EPSILON){y.normalize();var g=Math.acos(Math.min(Math.max(h.dir.dot(c.dir),-1),1));c.up.applyMatrix4(a.makeRotationAxis(y,g))}c.right.crossVectors(c.dir,c.up).normalize()}c.dist=h.dist+l;var f=d.dot(p);c.widthScale=Math.min(1/Math.sqrt((1+f)/2),1.415)||1,c.sharp=Math.abs(f-1)>.05&&u,this.count++},t}();function u(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r)}function h(t,r){return(h=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var c=function(t){function e(r,e){var i;return void 0===r&&(r=3e3),void 0===e&&(e=!1),(i=t.call(this)||this).setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*r),3).setUsage(THREE.DynamicDrawUsage)),i.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*r),3).setUsage(THREE.DynamicDrawUsage)),i.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*r),2).setUsage(THREE.DynamicDrawUsage)),e&&i.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(2*r),2).setUsage(THREE.DynamicDrawUsage)),i.drawRange.start=0,i.drawRange.count=0,i.setIndex(new Array(3*r)),i}u(e,t);var i=e.prototype;return i.update=function(t,e){void 0===e&&(e={});var i=function(t,e,i){void 0===i&&(i=!1);var s=e.width||.1,a=void 0!==e.progress?e.progress:1,o=void 0===e.arrow||e.arrow,n=void 0!==e.side?e.side:"both",u=s/2,h="both"!==n?s/2:s,c=t.distance(),d=a*c;if(0==c)return null;var p=u/h,l=u/c,y=0,g=[],f=[],v=[],E=[],b=[],m=0,w=new THREE.Vector3,z=new THREE.Vector3,x=new THREE.Vector3,R=new THREE.Vector3,A=new THREE.Vector3,V=new THREE.Vector3;function T(t){var r=0===g.length,e=t.sharp&&!r,s=t.dist/h,a=t.dist/c,o=t.dir,d=t.up,T=t.right;if("left"!==n?w.copy(T).multiplyScalar(u*t.widthScale):w.set(0,0,0),"right"!==n?z.copy(T).multiplyScalar(-u*t.widthScale):z.set(0,0,0),w.add(t.pos),z.add(t.pos),e){x.fromArray(g,g.length-6).sub(z),R.fromArray(g,g.length-3).sub(w);var _,H,S=x.length()-R.length();S>0?(_=x,H=z):(_=R,H=w),A.copy(_).setLength(Math.abs(S)).add(H);var M=V.copy(H).sub(A).normalize().dot(o)*V.copy(H).sub(A).length()*2;V.copy(o).setLength(M).add(A),S>0?(g.push(A.x,A.y,A.z,w.x,w.y,w.z,z.x,z.y,z.z,w.x,w.y,w.z,V.x,V.y,V.z,w.x,w.y,w.z),m+=6,b.push(m-6,m-8,m-7,m-6,m-7,m-5,m-4,m-6,m-5,m-2,m-4,m-1),y+=12):(g.push(z.x,z.y,z.z,A.x,A.y,A.z,z.x,z.y,z.z,w.x,w.y,w.z,z.x,z.y,z.z,V.x,V.y,V.z),m+=6,b.push(m-6,m-8,m-7,m-6,m-7,m-5,m-6,m-5,m-3,m-2,m-3,m-1),y+=12),f.push(d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z,d.x,d.y,d.z),v.push(s-p,0,s-p,1,s,0,s,1,s+p,0,s+p,1),i&&E.push(a-l,0,a-l,1,a,0,a,1,a+l,0,a+l,1)}else g.push(z.x,z.y,z.z,w.x,w.y,w.z),f.push(d.x,d.y,d.z,d.x,d.y,d.z),v.push(s,0,s,1),i&&E.push(a,0,a,1),m+=2,r||(b.push(m-2,m-4,m-3,m-2,m-3,m-1),y+=6)}var _,H=new THREE.Vector3;function S(t){var r=t.dir,e=t.up,a=t.right,o=t.dist/h,d=t.dist/c;"left"!==n?w.copy(a).multiplyScalar(2*u):w.set(0,0,0),"right"!==n?z.copy(a).multiplyScalar(2*-u):z.set(0,0,0),H.copy(r).setLength(3*u),w.add(t.pos),z.add(t.pos),H.add(t.pos),g.push(z.x,z.y,z.z,w.x,w.y,w.z,H.x,H.y,H.z),f.push(e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z),v.push(o,"both"!==n?"right"!==n?-2:0:-.5,o,"both"!==n?"left"!==n?2:0:1.5,o+1.5,"both"!==n?0:.5),i&&E.push(d,"both"!==n?"right"!==n?-2:0:-.5,d,"both"!==n?"left"!==n?2:0:1.5,d+1.5*s/c,"both"!==n?0:.5),m+=3,b.push(m-1,m-3,m-2),y+=3}if(d>0)for(var M=0;M<t.count;M++){var P=t.array[M];if(P.dist>d){var I=t.array[M-1];_=new r;var U=(d-I.dist)/(P.dist-I.dist);_.lerpPathPoints(I,P,U),T(_);break}T(P)}else _=t.array[0];o&&S(_=_||t.array[t.count-1]);return{position:g,normal:f,uv:v,uv2:E,indices:b,count:y}}(t,e);if(i){var s=!!this.getAttribute("uv2");this._updateAttributes(i.position,i.normal,i.uv,s?i.uv2:null,i.indices),this.drawRange.count=i.count}else this.drawRange.count=0},i._resizeAttribute=function(t,r){for(var e=this.getAttribute(t);e.array.length<r;){var i=e.array.length,s=new THREE.BufferAttribute(new Float32Array(2*i),e.itemSize,e.normalized);s.name=e.name,s.usage=e.usage,this.setAttribute(t,s),e=s}},i._resizeIndex=function(t){for(var r=this.getIndex();r.array.length<t;){var e=r.array.length,i=new THREE.BufferAttribute(2*e>65535?new Uint32Array(2*e):new Uint16Array(2*e),1);i.name=r.name,i.usage=r.usage,this.setIndex(i),r=i}},i._updateAttributes=function(t,r,e,i,s){this._resizeAttribute("position",t.length);var a=this.getAttribute("position");a.array.set(t,0),a.updateRange.count=t.length,a.needsUpdate=!0,this._resizeAttribute("normal",r.length);var o=this.getAttribute("normal");o.array.set(r,0),o.updateRange.count=r.length,o.needsUpdate=!0,this._resizeAttribute("uv",e.length);var n=this.getAttribute("uv");if(n.array.set(e,0),n.updateRange.count=e.length,n.needsUpdate=!0,i){this._resizeAttribute("uv2",i.length);var u=this.getAttribute("uv2");u.array.set(i,0),u.updateRange.count=i.length,u.needsUpdate=!0}this._resizeIndex(s.length);var h=this.getIndex();h.set(s,0),h.updateRange.count=s.length,h.needsUpdate=!0},e}(THREE.BufferGeometry);var d=function(t){function e(r,e){return t.call(this,r||1e3,e)||this}return u(e,t),e.prototype.update=function(t,e){void 0===e&&(e={});var i=function(t,e,i){void 0===i&&(i=!1);var s=e.radius||.1,a=void 0!==e.progress?e.progress:1,o=Math.max(2,e.radialSegments||8),n=e.startRad||0,u=2*s*Math.PI,h=t.distance(),c=a*h;if(0==c)return null;var d=0,p=[],l=[],y=[],g=[],f=[],v=0,E=new THREE.Vector3;function b(t,r,e){for(var s=0===p.length,a=t.dist/u,o=t.dist/h,c=0;c<=e;c++){var b=c;b==e&&(b=0),E.copy(t.up).applyAxisAngle(t.dir,n+2*Math.PI*b/e).normalize(),p.push(t.pos.x+E.x*r*t.widthScale,t.pos.y+E.y*r*t.widthScale,t.pos.z+E.z*r*t.widthScale),l.push(E.x,E.y,E.z),y.push(a,c/e),i&&g.push(o,c/e),v++}if(!s)for(var m=v-2*(e+1),w=v-(e+1),z=0;z<e;z++)f.push(w+z,m+z,m+z+1,w+z,m+z+1,w+z+1),d+=6}if(c>0)for(var m=0;m<t.count;m++){var w=t.array[m];if(w.dist>c){var z=t.array[m-1],x=new r,R=(c-z.dist)/(w.dist-z.dist);x.lerpPathPoints(z,w,R),b(x,s,o);break}b(w,s,o)}return{position:p,normal:l,uv:y,uv2:g,indices:f,count:d}}(t,e);if(i){var s=!!this.getAttribute("uv2");this._updateAttributes(i.position,i.normal,i.uv,s?i.uv2:null,i.indices),this.drawRange.count=i.count}else this.drawRange.count=0},e}(c);t.PathGeometry=c,t.PathPointList=n,t.PathTubeGeometry=d,Object.defineProperty(t,"__esModule",{value:!0})}));
